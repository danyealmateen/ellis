const e={logInpage:document.getElementById("logInpage"),container:document.getElementById("container"),body:document.getElementById("body"),imageSelection:document.getElementById("image-selection"),createAccountButton:document.getElementById("create-account-button"),submitButton:document.getElementById("submit-button"),usernameInput:document.getElementById("username"),passwordInput:document.getElementById("password"),errorMessage:document.createElement("p"),userDeletedSuccessfully:document.createElement("h1"),failedToDeleteUser:document.createElement("h1"),accountCreated:document.createElement("h1"),currentUser:document.getElementById("current-user"),statusUpdates:document.getElementById("status-updates"),loggedInUsersList:document.querySelector(".js-logged-in-users-list"),deleteAccountButton:document.getElementById("delete-account-button"),statusInput:document.getElementById("status-input"),submitStatus:document.getElementById("submit-status"),allUsersList:document.getElementById("allUsersList"),userStatus:document.getElementById("userStatus")};e.logInpage&&(e.logInpage.style.display="block"),e.container.style.display="none",e.body.appendChild(e.container);document.createElement("div").className="error-message";const t="https://social-media-68d76-default-rtdb.europe-west1.firebasedatabase.app/";async function s(){try{const e=await fetch(`${t}users.json`);if(!e.ok)throw new Error(`Error: ${e.status} ${e.statusText}`);const s=await e.json();if(!s)return[];return Object.values(s)}catch(e){throw new Error("Failed to fetch users")}}async function n(e){await s();const n=`${t}users/${e.userName}.json`,a={method:"PUT",body:JSON.stringify(e),headers:{"Content-type":"application/json; charset=UTF-8"}};try{const e=await fetch(n,a);if(!e.ok)throw new Error(`Error: ${e.status} ${e.statusText}`)}catch(e){throw console.log(e),new Error("Failed to save user information.")}}async function a(e){const s=`${t}users/${e}.json`,n={method:"DELETE"};try{const e=await fetch(s,n);if(!e.ok)throw new Error(`Error: ${e.status} ${e.statusText}`)}catch(e){throw console.log(e),new Error("Failed to delete user.")}}async function r(){const e=localStorage.getItem("loggedInUser");return e?await o(e):null}async function o(e){return(await s()).find((t=>t.userName===e))||null}async function l(){const t=await r();t&&(e.userStatus.textContent=`${t.userName}'s status: ${t.status}`)}async function d(){const t=await s();await r();t.forEach((t=>{const s=document.createElement("li");s.textContent=`${t.userName}:`,e.loggedInUsersList&&e.loggedInUsersList.appendChild(s)}))}async function i(){try{const t=await s(),n=document.createElement("ul");t.forEach((t=>{const s=document.createElement("li");s.classList.add("user-item");const a=t.statusUpdates&&t.statusUpdates.length>0?t.statusUpdates[t.statusUpdates.length-1]:"";let r="";if("object"==typeof a&&null!==a){const e=a.timestamp?new Date(a.timestamp):null;r=e?`${e.getFullYear()}-${String(e.getMonth()+1).padStart(2,"0")}-${String(e.getDate()).padStart(2,"0")} ${String(e.getHours()).padStart(2,"0")}:${String(e.getMinutes()).padStart(2,"0")}:${String(e.getSeconds()).padStart(2,"0")}`:""}const l=document.createElement("img");l.src=t.imageurl,l.width=50,l.height=50,l.style.marginRight="5px";const d=document.createTextNode(`${t.userName} - Last status: ${"object"==typeof a&&null!==a?a.status:"No status update yet"} ${r?`(${r})`:""}`);s.appendChild(l),s.appendChild(d),s.addEventListener("click",(()=>{!async function(t){const s=await o(t);document.getElementById("backButton").style.display="block",e.statusUpdates.style.display="none";if(document.querySelectorAll(".user-item").forEach((e=>{e.style.display="none"})),!s)throw new Error("User not found.");const n=document.getElementById("container"),a=document.getElementById("otherUserPage");if(n&&a){n.style.display="none",a.style.display="block",a.querySelector(".username").textContent=s.userName,a.querySelector(".profile-pic").setAttribute("src",s.imageurl);const e=a.querySelector(".status-updates");if(e)if(e.innerHTML="",s.statusUpdates)s.statusUpdates.sort(((e,t)=>new Date(t.timestamp).getTime()-new Date(e.timestamp).getTime())),s.statusUpdates.forEach((t=>{const s=document.createElement("p"),n=new Date(t.timestamp),a=`${n.getFullYear()}-${String(n.getMonth()+1).padStart(2,"0")}-${String(n.getDate()).padStart(2,"0")} ${String(n.getHours()).padStart(2,"0")}:${String(n.getMinutes()).padStart(2,"0")}:${String(n.getSeconds()).padStart(2,"0")}`;s.textContent=`${a}: ${t.status}`,e.appendChild(s)}));else{const t=document.createElement("p");t.textContent="No status update yet.",e.appendChild(t)}else console.error("Error: statusUpdatesContainer element is missing.")}else console.error("Error: loggedInUsersPage or otherUserPage element is missing.")}(t.userName)})),n.appendChild(s)})),e.allUsersList&&(e.allUsersList.innerHTML="",e.allUsersList.appendChild(n))}catch(e){console.log(e?.message??e)}}function u(){const t=document.getElementById("container"),s=document.getElementById("otherUserPage");if(document.getElementById("backButton").style.display="none",t&&s){t.style.display="block",s.style.display="none";const n=document.getElementById("userListWrapper");n&&(n.style.display="block"),e.statusUpdates.style.display="block";document.querySelectorAll(".user-item").forEach((e=>{e.style.display="block"}))}else console.error("Error: loggedInUsersPage or otherUserPage element is missing.")}async function c(){const t=e.usernameInput.value.trim(),n=e.passwordInput.value.trim();if(t&&n)try{const r=(await s()).find((e=>e.userName===t&&e.password===n));r?(await a(r.userName),localStorage.removeItem("loggedInUser"),e.userDeletedSuccessfully.innerHTML="User deleted successfully!",e.body.appendChild(e.userDeletedSuccessfully),setTimeout((()=>{e.userDeletedSuccessfully.remove()}),3e3),e.allUsersList.style.display="none",e.usernameInput.value="",e.passwordInput.value="",e.logInpage.style.display="block",document.getElementById("otherUserPage").style.display="none",document.getElementById("container").style.display="none",document.getElementById("logoutButton").style.display="none",document.getElementById("delete-account-button").style.display="none",document.getElementById("backButton").style.display="none",await i()):(e.failedToDeleteUser.innerHTML="Failed to delete user. Incorrect username or password.",e.body.appendChild(e.failedToDeleteUser),setTimeout((()=>{e.failedToDeleteUser.remove()}),3e3))}catch(t){console.log(t),e.failedToDeleteUser.innerHTML="Failed to delete user. Try again.",e.body.appendChild(e.failedToDeleteUser),setTimeout((()=>{e.failedToDeleteUser.remove()}),3e3)}else e.errorMessage.innerHTML="Please enter a username and password.",e.body.appendChild(e.errorMessage),setTimeout((()=>{e.errorMessage.remove()}),3e3)}function m(){e.createAccountButton.addEventListener("click",(()=>{!async function(){const t=e.usernameInput.value.trim(),s=e.passwordInput.value.trim(),a=e.imageSelection.value.trim();if(t&&s&&a)try{if(await o(t))return e.errorMessage.innerHTML="Username already exists. Please choose a different username.",e.body.appendChild(e.errorMessage),void setTimeout((()=>{e.errorMessage.remove()}),3e3);const r={userName:t,password:s,status:"",imageurl:a,newUser:!0,statusUpdates:[]};await n(r),e.accountCreated.innerHTML="Account Created! Now you can login!",e.body.appendChild(e.accountCreated),setTimeout((()=>{e.accountCreated.remove()}),1500)}catch(t){console.log(t),e.errorMessage.innerHTML="Failed to create account. Try again.",e.body.appendChild(e.errorMessage),setTimeout((()=>{e.errorMessage.remove()}),3e3)}else e.errorMessage.innerHTML="Please fill in all fields.",e.body.appendChild(e.errorMessage),setTimeout((()=>{e.errorMessage.remove()}),3e3)}()})),e.submitButton.addEventListener("click",(t=>{t.preventDefault(),async function(){const t=e.usernameInput.value.trim(),a=e.passwordInput.value.trim();if(t&&a)try{const r=(await s()).find((e=>e.userName===t&&e.password===a));if(!r)return e.errorMessage.innerHTML="Username does not exist. Please create an account before logging in.",e.body.appendChild(e.errorMessage),void setTimeout((()=>{e.errorMessage.remove()}),3e3);r.newUser=!1,r.status="logged-in",await n(r),localStorage.setItem("loggedInUser",r.userName),e.allUsersList.style.display="block",e.logInpage.style.display="none",e.container.style.display="block",e.currentUser?e.currentUser.textContent=`${r.userName}`:console.error("elements.currentUser is null"),d(),l()}catch(t){console.log(t),e.errorMessage.innerHTML="Failed to log in. Try again.",e.body.appendChild(e.errorMessage),setTimeout((()=>{e.errorMessage.remove()}),3e3)}else e.errorMessage.innerHTML="Please enter a username and password.",e.body.appendChild(e.errorMessage),setTimeout((()=>{e.errorMessage.remove()}),3e3);document.getElementById("logoutButton").style.display="block",document.getElementById("delete-account-button").style.display="block"}()})),e.deleteAccountButton.addEventListener("click",(()=>{c()})),e.submitStatus.addEventListener("click",(t=>{t.preventDefault(),async function(){const t=e.statusInput.value.trim();if(t)try{const s=await r();if(s){s.statusUpdates||(s.statusUpdates=[]);const a=(new Date).toISOString();s.statusUpdates.push({status:t,timestamp:a}),await n(s),e.statusInput.value="",i()}else e.errorMessage.innerHTML="Failed to find the current user.",e.body.appendChild(e.errorMessage),setTimeout((()=>{e.errorMessage.remove()}),3e3)}catch(t){console.log(t),e.errorMessage.innerHTML="Failed to update status. Try again.",e.body.appendChild(e.errorMessage),setTimeout((()=>{e.errorMessage.remove()}),3e3)}else e.errorMessage.innerHTML="Please enter a status update.",e.body.appendChild(e.errorMessage),setTimeout((()=>{e.errorMessage.remove()}),3e3)}()}));const t=document.getElementById("backButton");t?t.addEventListener("click",u):console.error("Error: backButton element is missing.")}e.allUsersList.parentNode.insertBefore(e.container,e.allUsersList),document.getElementById("logoutButton")?.addEventListener("click",(async function(){await async function(){const e=await r();e&&(e.status="logged-out",await n(e));localStorage.removeItem("loggedInUser")}().then((()=>{location.assign("./index.html")}))})),async function(){document.addEventListener("DOMContentLoaded",(async()=>{m(),await i(),await async function(){const t=localStorage.getItem("loggedInUser");if(t){const s=await o(t);s&&"logged-in"===s.status&&(e.logInpage.style.display="none",e.allUsersList.style.display="block",e.container.style.display="block",e.currentUser?e.currentUser.textContent=`${s.userName}`:console.error("elements.currentUser is null"),d(),l(),document.getElementById("logoutButton").style.display="block",document.getElementById("delete-account-button").style.display="block")}}()}))}();
//# sourceMappingURL=index.f2b40474.js.map
